<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Light Theme Variables */
        :root {
            --background-color: #ffffff;
            --text-color: #000000;
            --sidebar-background-color: #f4f4f4;
            --navbar-background-color: #f4f4f4;
            --navbar-text-color: #000000;
        }

        /* Dark Theme Variables */
        [data-theme="dark"] {
            --background-color: #333333;
            --text-color: #ffffff;
            --sidebar-background-color: #444444;
            --navbar-background-color: #444444;
            --navbar-text-color: #ffffff;
        }

        /* Applying Theme Variables */
        body {
            background-color: var(--background-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }

        .sidebar {
            background-color: var(--sidebar-background-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }

        nav {
            background-color: var(--navbar-background-color);
            color: var(--navbar-text-color);
            transition: background-color 0.3s, color 0.3s;
        }

        .theme-icon {
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="profile">
            <img src="images/profile.png" alt="Profile">
            <p id="userName">Username</p>
        </div>
        <div id="polyNo">
            <select id="options">
                <option value="option1">Dashboard</option>
                <option href="/Dashboard/polyhouse1.html" value="option2">Polyhouse 1</option>
                <option href="/Dashboard/polyhouse2.html" value="option3">Polyhouse 2</option>
            </select>
        </div>
        <div id="attributes">
            <a href="/Dashboard/details.html#temp_2">Temperature</a>
            <a href="/Dashboard/details.html#humidity_2">Humidity</a>
            <a href="/Dashboard/details.html#soilTemp_2">Soil Temperature</a>
            <a href="/Dashboard/details.html#waterTemp_2">Water Temperature</a>
            <a href="/Dashboard/details.html#co2_2">CO2</a>
            <a href="/Dashboard/details.html#light_2">Light</a>
            <a href="/Dashboard/details.html#moisture_2">Moisture</a>
            <a href="/Dashboard/details.html#actuators_2">Actuators</a>
            <a href="/Dashboard/details.html#pyranometer_2">Solar Irradiance</a>
            <a href="#" class="dropdown-toggle" onclick="toggleDropdown()">Control Panel</a>
            <a href="/Dashboard/controlpannel.html" onclick="showControlPanel('controlPannel1')">Polyhouse 1</a>
            <a href="/Dashboard/controlpannel.html" onclick="showControlPanel('controlPannel2')">Polyhouse 2</a>
        </div>
    </div>

    <!-- Header -->
    <nav>
        <div class="left">
            <img id="logo-l" src="images/logo.png" alt="Logo Light">
            <img id="logo-d" src="images/white logo.png" alt="Logo Dark" style="display: none;">
            <div class="links">
                <a href="#" id="dashboard">Dashboards</a>
                <span>/</span>
                <a href="https://www.canva.com/design/DAFl-x-HX70/AciH_KN62I30I3ZYvdQ2tw/view?utm_content=DAFl-x-HX70&utm_campaign=designshare&utm_medium=link&utm_source=publishsharelink" target="_blank">About</a>
                <a href="http://faculty.iitmandi.ac.in/~tushar" target="_blank">Contact</a>
                <a href="/Dashboard/Dashboard.html" id="dataRequestLink">Data Request</a>
            </div>
        </div>
        <div class="right">
            <a href="/login/index.html">Log Out</a>
            <div id="sun" class="theme-icon">
                <img src="images/sun.png" alt="Sun Icon">
            </div>
            <div id="moon" class="theme-icon" style="display: none;">
                <img src="images/moon.png" alt="Moon Icon">
            </div>
            <div class="hamburger" onclick="toggleMenu()">
                <img src="images/hamburger.png" alt="Menu Icon">
            </div>
        </div>
    </nav>

    <!-- Mobile Menu -->
    <div id="mobileMenu" class="mobile-menu">
        <a href="#" id="dashboard">Dashboards</a>
        <a href="https://www.canva.com/design/DAFl-x-HX70/AciH_KN62I30I3ZYvdQ2tw/view?utm_content=DAFl-x-HX70&utm_campaign=designshare&utm_medium=link&utm_source=publishsharelink" target="_blank">About</a>
        <a href="http://faculty.iitmandi.ac.in/~tushar" target="_blank">Contact</a>
        <a href="/Dashboard/Dashboard.html" id="dataRequestLink">Data Request</a>
        <div id="controlPannel1" class="controlPannel">
            <!-- Add your control panel 1 content here -->
        </div>
    
        <div id="controlPannel2" class="controlPannel" style="display: none;">
            <!-- Add your control panel 2 content here -->
        </div>
    </div>

    <!-- Control Panel -->
    <div id="controlPannel">
        <div class="knobs">
            <div id="knob1" class="knob">
                <button onclick="updateSensor('sensor1', 'Low')" class="off">Off</button>
                <button onclick="updateSensor('sensor1', 'High')" class="on">On</button>
                <button onclick="updateSensor('sensor1', 'Auto')" class="auto">Auto</button>
                <img src="https://clipground.com/images/knobs-clipart-7.jpg" alt="" id="slider1" class="slider" />
            </div>
            <div id="knob2" class="knob">
                <button onclick="updateSensor('sensor2', 'Low')" class="off">Off</button>
                <button onclick="updateSensor('sensor2', 'High')" class="on">On</button>
                <button onclick="updateSensor('sensor2', 'Auto')" class="auto">Auto</button>
                <img src="https://clipground.com/images/knobs-clipart-7.jpg" alt="" id="slider2" class="slider" />
            </div>
            <div id="knob3" class="knob">
                <button onclick="updateSensor('sensor3', 'Low')" class="off">Off</button>
                <button onclick="updateSensor('sensor3', 'High')" class="on">On</button>
                <button onclick="updateSensor('sensor3', 'Auto')" class="auto">Auto</button>
                <img src="https://clipground.com/images/knobs-clipart-7.jpg" alt="" id="slider3" class="slider" />
            </div>
        </div>
        <div class="display">
            <div id="screen">
                <div id="section1">
                    <p>TEMPERATURE</p>
                    <p>HUMIDITY</p>
                    <p>TIMER</p>
                </div>
                <div id="section2">
                    <div class="digits" id="screen_temp">27.2</div>
                    <div class="digits" id="screen_humid">66</div>
                    <div class="digits">1</div>
                </div>
                <div id="section3">
                    <div class="check" id="power"></div>
                    <div class="check" id="error"></div>
                    <div class="check" id="fogger"></div>
                    <div class="check" id="coolingPad"></div>
                    <div class="check" id="ventilation"></div>
                    <div class="check" id="light-screen"></div>
                </div>
                <div class="cp-p" id="section4">
                    <p class='p1'>POWER</p>
                    <p class='p2'>ERROR</p>
                    <p class='p3'>FOGGER</p>
                    <p class='p4'>COOLING PAD</p>
                    <p class='p5'>VENTILATION</p>
                    <p class='p6'>LIGHT</p>
                </div>
            </div>
        </div>
        <div class="knobs">
            <div id="knob4" class="knob">
                <button onclick="updateSensor('sensor4', 'Low')" class="off">Off</button>
                <button onclick="updateSensor('sensor4', 'High')" class="on">On</button>
                <button onclick="updateSensor('sensor4', 'Auto')" class="auto">Auto</button>
                <img src="https://clipground.com/images/knobs-clipart-7.jpg" alt="" id="slider4" class="slider" />
            </div>
            <div id="knob5" class="knob">
                <button onclick="updateSensor('sensor5', 'Low')" class="off">Off</button>
                <button onclick="updateSensor('sensor5', 'High')" class="on">On</button>
                <button onclick="updateSensor('sensor5', 'Auto')" class="auto">Auto</button>
                <img src="https://clipground.com/images/knobs-clipart-7.jpg" alt="" id="slider5" class="slider" />
            </div>
            <div id="knob6" class="knob">
                <button onclick="updateSensor('sensor6', 'Low')" class="off">Off</button>
                <button onclick="updateSensor('sensor6', 'High')" class="on">On</button>
                <button onclick="updateSensor('sensor6', 'Auto')" class="auto">Auto</button>
                <img src="https://clipground.com/images/knobs-clipart-7.jpg" alt="" id="slider6" class="slider" />
            </div>
        </div>
    </div>

    <script>
        const GET_SENSOR_VALUES_URL = 'YOUR_GET_SENSOR_VALUES_URL';
        const UPDATE_SENSOR_VALUES_URL = 'YOUR_UPDATE_SENSOR_VALUES_URL';
        const POLYHOUSE_GET = 'YOUR_POLYHOUSE_GET_URL';

        function updateSensor(sensor, value) {
            let data = {
                sensors: {}
            };

            fetch(GET_SENSOR_VALUES_URL)
                .then(response => response.json())
                .then(response => {
                    const currentSensorValues = response[0].plants[0].sensors;
                    data.sensors = { ...currentSensorValues };
                    data.sensors[sensor] = value;

                    return fetch(UPDATE_SENSOR_VALUES_URL, {
                        method: 'PATCH',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data),
                    });
                })
                .then(response => response.json())
                .then(result => {
                    console.log('Patch request successful', result);
                    fetchSensorValues();
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }

        function fetchSensorValues() {
            fetch(POLYHOUSE_GET)
                .then(response => response.json())
                .then(data => {
                    const sensorData = data[0].plants[0].sensors;

                    for (let i = 1; i <= 6; i++) {
                        const sensorId = "sensor" + i;
                        const sensorValue = sensorData[sensorId.toLowerCase()];

                        const sensorButton = document.querySelector(
                            "#sensors div:nth-child(" + i + ") button"
                        );
                        const sensorValueSpan = document.getElementById(sensorId + "-value");

                        sensorButton.classList.remove("high", "low", "auto");
                        sensorButton.classList.add(sensorValue.toLowerCase());

                        if (sensorValueSpan) {
                            sensorValueSpan.innerText = "Current value: " + sensorValue;
                        }
                    }

                    const buttons = document.querySelectorAll("#sensors button");
                    buttons.forEach(function (button) {
                        const sensorValue = button.textContent;
                        const sensorName = button.parentNode
                            .querySelector("h2")
                            .textContent.toLowerCase();
                        if (sensorValue.toLowerCase() === sensorData[sensorName]) {
                            button.classList.add("current-value");
                        } else {
                            button.classList.remove("current-value");
                        }
                    });
                })
                .catch(error => {
                    console.error("Error retrieving sensor values:", error);
                });
        }

        document.addEventListener('DOMContentLoaded', function () {
            fetchSensorValues();

            // Apply the previously selected theme
            const currentTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', currentTheme);
            document.getElementById(currentTheme === 'light' ? 'sun' : 'moon').style.display = 'block';
            document.getElementById(currentTheme === 'light' ? 'moon' : 'sun').style.display = 'none';
        });

        function toggleMenu() {
            const mobileMenu = document.getElementById('mobileMenu');
            mobileMenu.style.display = mobileMenu.style.display === 'block' ? 'none' : 'block';
        }
        function toggleDropdown() {
            const dropdown = document.getElementById('dropdown-toggle');
            dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
        }

        function showControlPanel(panelId) {
            const panels = document.querySelectorAll('.controlPannel');
            panels.forEach(panel => panel.style.display = 'none');
            document.getElementById(panelId).style.display = 'flex';
        }

        document.getElementById('dataRequestLink').addEventListener('click', () => {
            const poly1 = document.getElementById('Polyhouse1');
            const poly2 = document.getElementById('Polyhouse2');
            const sidebar1 = document.getElementById('attributes');
            const sidebar2 = document.getElementById('attributes_2');
            const pannel = document.getElementById("controlPannel");
            const dataDownloadRequest = document.getElementById("download");
            const map1 = document.getElementById("map1");
            const map2 = document.getElementById("map2");

            poly1.style.display = "none";
            poly2.style.display = "none";
            sidebar1.style.display = "flex";
            sidebar2.style.display = "none";
            pannel.style.display = "none";
            dataDownloadRequest.style.display = "flex";
            map1.style.display = "none";
            map2.style.display = "none";
        });

        document.querySelectorAll('.theme-icon').forEach(icon => {
            icon.addEventListener('click', () => {
                const moon = document.getElementById('moon');
                const sun = document.getElementById('sun');
                const logoLight = document.getElementById("logo-l");
                const logoDark = document.getElementById("logo-d");
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';

                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);

                if (newTheme === 'light') {
                    sun.style.display = 'block';
                    moon.style.display = 'none';
                    logoLight.style.display = 'block';
                    logoDark.style.display = 'none';
                } else {
                    moon.style.display = 'block';
                    sun.style.display = 'none';
                    logoLight.style.display = 'none';
                    logoDark.style.display = 'block';
                }
            });
        });
    </script>
</body>
</html>
